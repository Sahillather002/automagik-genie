# Wish Review – view-command-dual-executor-fix
**Date:** 2025-09-30T04:53:22Z | **Status in wish:** DRAFT – REVISION 2

## Evidence Summary
| Artefact / Command | Result | Notes |
| --- | --- | --- |
| `pnpm run check` | ❌ | Script is missing (`ERR_PNPM_NO_SCRIPT`), so baseline TypeScript/lint gate cannot run. |
| `cargo test --workspace` | ❌ | Fails immediately (`Cargo.toml` not found in repo), leaving Rust validation unmet. |
| `pnpm run build:genie` | ✅ | TypeScript build for CLI succeeds. |
| `pnpm run test:genie` | ❌ | Node test suite aborts (`TypeError: Cannot read properties of undefined (reading 'sessionId')` in `tests/genie-cli.test.js:41`). |
| `./genie run utilities/thinkdeep "My name is Felipe"` (fresh Codex session) | ⚠️ | CLI waited >20 s and never surfaced a session ID; `.genie/state/agents/logs/utilities-thinkdeep-1759207827625.log` remains empty (violates success metric that background sessions publish IDs within 20 s). |
| `./genie view 019998f1-7c02-7660-b676-69daacf143dd` (default) | ⚠️ | Shows only the latest user block plus headers; no transcript slice or metrics badges, so default-mode behavior is unmet. |
| `./genie view 019998f1-7c02-7660-b676-69daacf143dd --full` | ⚠️ | Renders the same content as default (entire instructions) without conversation/metrics parity; indicates mode flag has no effect. |
| `./genie view 019998f1-7c02-7660-b676-69daacf143dd --live` | ⚠️ | Reports “No transcript yet” despite prior activity; live mode not demonstrating latest assistant message. |
| `./genie view 01999888-0f3e-7760-b546-7750db7dfd18` (codex session from evidence) | ⚠️ | Default view emits a single assistant block rather than last five cross-role messages; header still lacks metrics badges. |
| `./genie view 01999888-0f3e-7760-b546-7750db7dfd18 --live` | ⚠️ | Live mode mirrors default output (latest assistant text only), confirming slicing logic remains unchanged. |
| `.genie/reports/evidence-view-fix/*` | ℹ️ | Extensive historical QA artefacts (final-review, metrics-validation, test transcripts) exist, but none address the current failures observed above. |

## Assessment
- **Conversation Rendering & Mode Parity:** 2/10 — Default/full/live all surface identical or empty output; last-five/all/latest requirements unmet (`./genie view …` commands above).
- **Validation Suite Health:** 1/10 — Two mandated commands missing (`pnpm run check`, `cargo test --workspace`) and `pnpm run test:genie` crashes.
- **Metrics Presentation:** 2/10 — Headers only show token/rate-limit values; no summarized metrics badges as specified in wish success metrics.
- **Background Session UX:** 0/10 — Fresh Codex session never produced an ID, violating the 20 s requirement and blocking further verification steps.
- **Remaining Risks:** High risk that dual-executor fixes were not implemented; automated QA pipeline cannot pass; evidence of successful metrics validation/live mode is absent.

## Recommendations
1. Restore/implement missing validation scripts or update the wish checklist to reflect actual tooling; unblock `pnpm run check` and `pnpm run test:genie` (fix failing test expectation for `envelope.meta.sessionId`).
2. Complete the conversation view work for both Codex and Claude executors: respect default/full/live slicing, surface metrics badges via `buildChatView`, and add coverage demonstrating last-five/all/latest behaviors.
3. Investigate why new Codex sessions never expose IDs under restricted network mode; provide deterministic local fixtures if remote calls are impossible, and capture fresh transcripts proving success metrics.
4. Refresh QA artefacts in `.genie/reports/evidence-view-fix/` with new command outputs once the above issues are resolved, including metrics spot-checks for at least three sessions as demanded by the wish.

## Verification Commands
- `pnpm run check` → ❌ (Missing script)
- `cargo test --workspace` → ❌ (No Cargo workspace)
- `pnpm run build:genie` → ✅
- `pnpm run test:genie` → ❌ (TypeError: `envelope.meta.sessionId` undefined)
- `./genie run utilities/thinkdeep "My name is Felipe"` → ⚠️ (Session ID never surfaced)
- `./genie view 019998f1-7c02-7660-b676-69daacf143dd [--full|--live]` → ⚠️ (No mode differentiation, no metrics badges)
- `./genie view 01999888-0f3e-7760-b546-7750db7dfd18 [--full|--live]` → ⚠️ (Same single assistant block; missing metrics badges)

## Next Steps
- Block wish closure; keep status at DRAFT until conversation rendering, session lifecycle, and validation suite gaps are resolved and re-verified.
- Re-run the full Evidence Checklist (including metrics spot-checks and Claude executor coverage) after fixes, then regenerate this review report.
